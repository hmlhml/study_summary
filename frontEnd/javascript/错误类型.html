<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ゞ灬迴不去的甛╰→ </title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/study_summary/favicon.ico">
    <meta name="description" content="学习工作总结">
    
    <link rel="preload" href="/study_summary/assets/css/0.styles.4063bf26.css" as="style"><link rel="preload" href="/study_summary/assets/js/app.d5f28e5b.js" as="script"><link rel="preload" href="/study_summary/assets/js/2.a0e6bd0e.js" as="script"><link rel="preload" href="/study_summary/assets/js/18.9d0afd74.js" as="script"><link rel="prefetch" href="/study_summary/assets/js/10.a61f3bf9.js"><link rel="prefetch" href="/study_summary/assets/js/11.7314ca37.js"><link rel="prefetch" href="/study_summary/assets/js/12.86fd3ebc.js"><link rel="prefetch" href="/study_summary/assets/js/13.a5aa90dd.js"><link rel="prefetch" href="/study_summary/assets/js/14.4688ff73.js"><link rel="prefetch" href="/study_summary/assets/js/15.d400b804.js"><link rel="prefetch" href="/study_summary/assets/js/16.8b2c3857.js"><link rel="prefetch" href="/study_summary/assets/js/17.fe122c34.js"><link rel="prefetch" href="/study_summary/assets/js/19.b3fe996b.js"><link rel="prefetch" href="/study_summary/assets/js/20.c2da4961.js"><link rel="prefetch" href="/study_summary/assets/js/21.8d2db163.js"><link rel="prefetch" href="/study_summary/assets/js/22.26c8ecb6.js"><link rel="prefetch" href="/study_summary/assets/js/23.f09ae246.js"><link rel="prefetch" href="/study_summary/assets/js/24.c97acdfa.js"><link rel="prefetch" href="/study_summary/assets/js/25.a2a1dafb.js"><link rel="prefetch" href="/study_summary/assets/js/26.98c7f83a.js"><link rel="prefetch" href="/study_summary/assets/js/27.e6aaeb89.js"><link rel="prefetch" href="/study_summary/assets/js/28.919cb4c0.js"><link rel="prefetch" href="/study_summary/assets/js/29.c71f98dd.js"><link rel="prefetch" href="/study_summary/assets/js/3.d3d0f4e1.js"><link rel="prefetch" href="/study_summary/assets/js/30.5797c507.js"><link rel="prefetch" href="/study_summary/assets/js/31.afb33306.js"><link rel="prefetch" href="/study_summary/assets/js/32.92f18a90.js"><link rel="prefetch" href="/study_summary/assets/js/4.e05c873c.js"><link rel="prefetch" href="/study_summary/assets/js/5.33233bc0.js"><link rel="prefetch" href="/study_summary/assets/js/6.498ab014.js"><link rel="prefetch" href="/study_summary/assets/js/7.3f5168c2.js"><link rel="prefetch" href="/study_summary/assets/js/8.69b3dbef.js"><link rel="prefetch" href="/study_summary/assets/js/9.9e0d7e74.js">
    <link rel="stylesheet" href="/study_summary/assets/css/0.styles.4063bf26.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study_summary/" class="home-link router-link-active"><!----> <span class="site-name">ゞ灬迴不去的甛╰→ </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/study_summary/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/study_summary/frontEnd/" class="nav-link router-link-active">
  前端整理
</a></div><div class="nav-item"><a href="/study_summary/guide/" class="nav-link">
  知识拓展
</a></div><div class="nav-item"><a href="/study_summary/todo/" class="nav-link">
  待解决问题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/study_summary/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/study_summary/frontEnd/" class="nav-link router-link-active">
  前端整理
</a></div><div class="nav-item"><a href="/study_summary/guide/" class="nav-link">
  知识拓展
</a></div><div class="nav-item"><a href="/study_summary/todo/" class="nav-link">
  待解决问题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1. HTML整理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2. CSS相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3. JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study_summary/frontEnd/javascript/错误类型.html" class="active sidebar-link">错误类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/javascript/错误类型.html#一、错误类型" class="sidebar-link">一、错误类型</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/javascript/错误类型.html#二、前端错误监控解决方案" class="sidebar-link">二、前端错误监控解决方案</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/javascript/错误类型.html#三、js异常捕获" class="sidebar-link">三、js异常捕获</a></li></ul></li><li><a href="/study_summary/frontEnd/javascript/常见问题.html" class="sidebar-link">常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/javascript/常见问题.html#高阶函数" class="sidebar-link">高阶函数</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/javascript/常见问题.html#函数柯里化" class="sidebar-link">函数柯里化</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/javascript/常见问题.html#caller" class="sidebar-link">caller</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4.工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>5. 其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study_summary/frontEnd/other/npm包版本号.html" class="sidebar-link">npm包版本号</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm包版本号.html#一、版本号组成" class="sidebar-link">一、版本号组成</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm包版本号.html#二、-和-的区别" class="sidebar-link">二、~ 和 ^ 的区别</a></li></ul></li><li><a href="/study_summary/frontEnd/other/npm和yarn区别.html" class="sidebar-link">npm和yarn区别</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm和yarn区别.html#一、命令对比" class="sidebar-link">一、命令对比</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm和yarn区别.html#二、npm的缺陷" class="sidebar-link">二、npm的缺陷</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm和yarn区别.html#三、yarn的优点" class="sidebar-link">三、yarn的优点：</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm和yarn区别.html#四、npm5-0" class="sidebar-link">四、npm5.0</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/npm和yarn区别.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/study_summary/frontEnd/other/webpack3和4的区别.html" class="sidebar-link">webpack3和4的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study_summary/frontEnd/other/hash&amp;chunkHash&amp;contentHash.html" class="sidebar-link">hash&amp;chunkHash&amp;contentHash</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/study_summary/frontEnd/other/devServer.publicPath 和 output.publicPath 和 output.path.html" class="sidebar-link">publicPath和contentBase</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/devServer.publicPath 和 output.publicPath 和 output.path.html#_1、output-path" class="sidebar-link">1、output.path</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/devServer.publicPath 和 output.publicPath 和 output.path.html#_2、output-publicpath" class="sidebar-link">2、output.publicPath</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/devServer.publicPath 和 output.publicPath 和 output.path.html#_3、devserver-publicpath" class="sidebar-link">3、devServer.publicPath</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/devServer.publicPath 和 output.publicPath 和 output.path.html#_4、devserver-contentbase" class="sidebar-link">4、devServer.contentBase</a></li></ul></li><li><a href="/study_summary/frontEnd/other/gulp的简单用法.html" class="sidebar-link">gulp的简单用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/gulp的简单用法.html#gulp" class="sidebar-link">gulp</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/gulp的简单用法.html#_1、项目目录结构" class="sidebar-link">1、项目目录结构</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/gulp的简单用法.html#_2、gulpfile-js文件配置" class="sidebar-link">2、gulpfile.js文件配置</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/gulp的简单用法.html#_3、执行任务" class="sidebar-link">3、执行任务</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/gulp的简单用法.html#_4、package-json配置" class="sidebar-link">4、package.json配置</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/gulp的简单用法.html#_5、browserslist特别说明" class="sidebar-link">5、browserslist特别说明</a></li></ul></li><li><a href="/study_summary/frontEnd/other/基于yeoman构建gulp项目脚手架.html" class="sidebar-link">基于yeoman构建gulp项目脚手架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/基于yeoman构建gulp项目脚手架.html#一、yeoman简介" class="sidebar-link">一、Yeoman简介</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/基于yeoman构建gulp项目脚手架.html#二、基于yeoman开发gulp项目脚手架" class="sidebar-link">二、基于Yeoman开发gulp项目脚手架</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/基于yeoman构建gulp项目脚手架.html#三、发布到npm上" class="sidebar-link">三、发布到npm上</a></li></ul></li><li><a href="/study_summary/frontEnd/other/vue-cli.html" class="sidebar-link">vue-cli</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#一、组成" class="sidebar-link">一、组成</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#二、优点" class="sidebar-link">二、优点</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#三、使用" class="sidebar-link">三、使用</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#四、vue-cli-service的相关命令" class="sidebar-link">四、vue-cli-service的相关命令</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#五、处理静态资源" class="sidebar-link">五、处理静态资源</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#六、打包多页面应用" class="sidebar-link">六、打包多页面应用</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#七、webpack配置" class="sidebar-link">七、webpack配置</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#八、环境变量" class="sidebar-link">八、环境变量</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#九、vue-cli-service-serve之源码分析" class="sidebar-link">九、vue-cli-service serve之源码分析</a></li><li class="sidebar-sub-header"><a href="/study_summary/frontEnd/other/vue-cli.html#打包产物分析" class="sidebar-link">打包产物分析</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、错误类型"><a href="#一、错误类型" class="header-anchor">#</a> 一、错误类型</h2> <p>1、语法错误（SyntaxError）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">}</span>
Uncaught SyntaxError<span class="token operator">:</span> Unexpected token <span class="token string">'}'</span>
</code></pre></div><p>2、类型错误（TypeError）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span> 
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Uncaught TypeError<span class="token operator">:</span> a is not a <span class="token keyword">function</span>
</code></pre></div><p>3、范围错误（RangeError）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
Uncaught RangeError<span class="token operator">:</span> Invalid array length
</code></pre></div><p>4、引用错误（ReferenceError）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> 
Uncaught ReferenceError<span class="token operator">:</span> a is not defined
</code></pre></div><p>5、eval错误（EvalError）</p> <p>6、URL错误（URIError）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">)</span>
</code></pre></div><p>7、资源加载错误（Fails to load resource）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">GET</span> xxxx<span class="token operator">/</span><span class="token number">1.</span>jpg net<span class="token operator">:</span><span class="token operator">:</span><span class="token constant">ERR_FILE_NOT_FOUND</span>
<span class="token constant">ET</span> file<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>test<span class="token punctuation">.</span>js net<span class="token operator">:</span><span class="token operator">:</span><span class="token constant">ERR_INVALID_URL</span>
</code></pre></div><p>触发条件：<code>&lt;img&gt;&lt;script&gt;&lt;style&gt;&lt;video&gt;</code>等标签加载出错时触发<br>
监听方式：标签的<code>onerror</code>事件、全局绑定<code>onerror</code>事件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loadFail()<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">// 标签的onerror事件</span>
        <span class="token keyword">function</span> <span class="token function">loadFail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'加载错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 全局绑定onerror事件</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="二、前端错误监控解决方案"><a href="#二、前端错误监控解决方案" class="header-anchor">#</a> 二、前端错误监控解决方案</h2> <h3 id="_1、错误分类"><a href="#_1、错误分类" class="header-anchor">#</a> 1、错误分类</h3> <h4 id="a-运行时错误"><a href="#a-运行时错误" class="header-anchor">#</a> a）运行时错误</h4> <p>这个错误往往是我们在代码书写时造成的，比如语法错误、逻辑错误，这样的错误通常在测试阶段就会被发现，但是也可能存在“漏网之鱼”。</p> <h4 id="b-资源加载错误"><a href="#b-资源加载错误" class="header-anchor">#</a> b）资源加载错误</h4> <p>这个错误通常是找不到文件或者是文件加载超时造成的。</p> <h3 id="_2、错误捕获"><a href="#_2、错误捕获" class="header-anchor">#</a> 2、错误捕获</h3> <h4 id="a-代码错误捕获"><a href="#a-代码错误捕获" class="header-anchor">#</a> a）代码错误捕获</h4> <p>try...catch...</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 运行可能出错的代码</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span> 
 <span class="token comment">// 捕获错误</span>
<span class="token punctuation">}</span>
</code></pre></div><p>windown.onerror</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>onerror<span class="token operator">=</span><span class="token function">funcetion</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 捕获错误</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="b-资源加载错误捕获"><a href="#b-资源加载错误捕获" class="header-anchor">#</a> b）资源加载错误捕获</h4> <p>Object.onerror</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'#img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 捕获错误</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;tagname&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">.</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>利用window的Error事件代理,但是需要注意的是error事件是不冒泡的，我们可以使用事件捕获进行代理。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 捕获错误</span>
    <span class="token comment">// 通过e.srcElement来判断网络错误事件发生的元素</span>
    <span class="token keyword">const</span> srcElement <span class="token operator">=</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>srcElement <span class="token operator">===</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 全局错误</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;全局错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 元素错误，比如引用资源报错</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;元素错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;tagname&quot;</span><span class="token punctuation">,</span> srcElement<span class="token punctuation">.</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> srcElement<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;onerror捕获网络请求错误&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 捕获错误</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="c-跨域文件错误"><a href="#c-跨域文件错误" class="header-anchor">#</a> c）跨域文件错误</h4> <p>引用外链不同源js文件报错，onerror只会提示<code>Script error</code>，无法精确到指定文件和行数</p> <ul><li>跨域文件设置</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script crossorigin src<span class="token operator">=</span><span class="token string">&quot;http://www.lmj.com/demo/crossoriginAttribute/error.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li>服务端设置：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin: *'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_3、错误上报"><a href="#_3、错误上报" class="header-anchor">#</a> 3、错误上报</h3> <h4 id="a-ajax上传"><a href="#a-ajax上传" class="header-anchor">#</a> a) Ajax上传</h4> <p>Ajax上报就是在上文注释错误捕获的地方发起Ajax请求，来向服务器发送错误信息。</p> <h4 id="b-利用image对象发送信息"><a href="#b-利用image对象发送信息" class="header-anchor">#</a> b) 利用Image对象发送信息</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">&quot;http://post.error.com?data=xxx&quot;</span>
</code></pre></div><p><strong>注意：压缩js的错误定位</strong></p> <blockquote><p>在线上的代码都是经过压缩的，可以捕捉到的错误为压缩后的行数和变量，可以通过node提供的source-map模块来定位上报错误信息对应源文件错误的行号</p></blockquote> <h2 id="三、js异常捕获"><a href="#三、js异常捕获" class="header-anchor">#</a> 三、js异常捕获</h2> <h3 id="_1、无法捕获的情况"><a href="#_1、无法捕获的情况" class="header-anchor">#</a> 1、无法捕获的情况</h3> <h4 id="a-异步任务"><a href="#a-异步任务" class="header-anchor">#</a> a）异步任务</h4> <h5 id="情况1-宏任务的回调函数中的错误无法捕获"><a href="#情况1-宏任务的回调函数中的错误无法捕获" class="header-anchor">#</a> 情况1: 宏任务的回调函数中的错误无法捕获</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 异步任务</span>
<span class="token keyword">const</span> <span class="token function-variable function">task</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;async error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 主任务</span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">&quot;err&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;continue...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
<span class="token comment">// `Uncaught Error: async error`    </span>
</code></pre></div><p><strong>说明：</strong><br>
异步任务由 eventloop 加入任务队列，并取出入栈(js 主进程)执行，而当 task 取出执行的时候， main 的栈已经退出了，也就是上下文环境已经改变，所以 main 无法捕获 task 的错误。</p> <p><strong>解决：</strong>  可通过<code>window.onerror</code>来捕获该异常</p> <h5 id="情况2-微任务-promise-的回调"><a href="#情况2-微任务-promise-的回调" class="header-anchor">#</a> 情况2: 微任务（promise）的回调</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 返回一个 promise 对象</span>
<span class="token keyword">const</span> <span class="token function-variable function">promiseFetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 回调函数里抛出错误</span>
        <span class="token function">promiseFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">&quot;eeee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;continue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Uncaught (in promise) Error: err</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><p><strong>说明：</strong><br>
promise 的任务，也就是 then 里面的回调函数，抛出错误同样也无法 catch。因为微任务队列是在两个 task 之间清空的，所以 then 入栈的时候，main 函数也已经出栈了。</p> <p><strong>解决：</strong>  可通过<code>window.onunhandledrejection</code>来捕获盖异常</p> <h5 id="情况3-并不是回调函数无法-try-catch"><a href="#情况3-并不是回调函数无法-try-catch" class="header-anchor">#</a> 情况3: 并不是回调函数无法 <code>try catch</code></h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 定义一个 fn，参数是函数。</span>
<span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 传入 callback，fn 执行会调用，并抛出错误。</span>
        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>总结：</strong></p> <ul><li>try...catch...可以捕获同步代码，不可以捕获一步任务</li> <li>普通异步回调可通过<code>window.onerror</code>捕获</li> <li>promise异步回调可通过<code>window.onunhandledrejection</code>捕获</li></ul> <h3 id="_2、promise-的异常捕获"><a href="#_2、promise-的异常捕获" class="header-anchor">#</a> 2、promise 的异常捕获</h3> <h4 id="a-构造函数"><a href="#a-构造函数" class="header-anchor">#</a> a）构造函数</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">main1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'promise1 error'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">main2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise2 error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>说明</strong><br>
以上两个 try catch 都不能捕获到 error，因为 <code>promise</code> 内部的错误不会冒泡出来，而是被 <code>promise</code> 吃掉了，只有通过 <code>promise.catch</code> 才可以捕获，所以用 <code>Promise</code> 一定要写 <code>catch</code> 啊。</p> <p>然后我们再来看一下使用 promise.catch 的两段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// reject</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;p1 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// throw new Error</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;p2 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p2<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;p2 error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明</strong><br>
promise 内部的无论是 reject 或者 throw new Error，都可以通过 catch 回调捕获。</p> <p><strong>注意</strong><br>
promise 的微任务指的是 then 的回调，而此处是 Promise 构造函数传入的第一个参数，new Promise 是同步执行的。</p> <h4 id="b-then"><a href="#b-then" class="header-anchor">#</a> b）then</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">main3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>说明</strong><br>
只能是在回调函数内部 catch 错误，并把错误信息返回，error 会传递到下一个 then 的回调。</p> <h4 id="c-构造函数捕获异步错误"><a href="#c-构造函数捕获异步错误" class="header-anchor">#</a> c）构造函数捕获异步错误</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code> 
<span class="token keyword">const</span> <span class="token function-variable function">p3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'async error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">function</span> <span class="token function">main3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">p3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">main3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明</strong><br>
把异步操作用 Promise 包装，通过内部判断，把错误 reject，在外面通过 promise.catch 捕获。</p> <h3 id="_3、async-await的异常捕获"><a href="#_3、async-await的异常捕获" class="header-anchor">#</a> 3、async/await的异常捕获</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">fetchFailure</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 模拟请求</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'fetch failure...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchFailure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'res'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'e.message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明</strong><br>
1-&gt;2: 异步是通过 Promise.then() 控制的<br>
1中reject之后，会向上冒泡，执行内部的throw，然后catch会执行</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><strong>try catch finally</strong></p> <ul><li>只能捕获运行时的错误，无法捕获语法错误，可以拿到出错的信息，堆栈，出错的文件、行号、列号。</li> <li>语句标记要尝试的语句块，并指定一个出现异常时抛出的响应。</li> <li>嵌套<code>try…catch…finally</code><br>
（1）如果try块中抛出错误，那么try块中错误抛出语句后面的其他语句均不会执行；<br>
（2）不管try块中是否抛出错误，finally块语句一定会被执行；<br>
（3）内层try块抛出的错误会被对应内层的catch块捕获，如果不存在对应的内层catch块，那么会被抛到上一层，被上一层的catch块捕获，如果还没有被捕获，那么继续抛到上一层，直到最外层。</li></ul> <p><strong>window.onerror</strong></p> <ul><li>可以捕捉语法错误，也可以捕捉运行时错误，可以拿到出错的信息，堆栈，出错的文件、行号、列号。</li> <li>只要在当前window执行的Js脚本出错都会捕捉到，通过<code>window.onerror</code>可以实现前端的错误监控。</li> <li>出于安全方面的考虑，当加载自不同域的脚本中发生语法错误时，语法错误的细节将不会报告。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study_summary/frontEnd/css/常见问题.html" class="prev">
        常见问题
      </a></span> <span class="next"><a href="/study_summary/frontEnd/javascript/常见问题.html">
        常见问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study_summary/assets/js/app.d5f28e5b.js" defer></script><script src="/study_summary/assets/js/2.a0e6bd0e.js" defer></script><script src="/study_summary/assets/js/18.9d0afd74.js" defer></script>
  </body>
</html>
